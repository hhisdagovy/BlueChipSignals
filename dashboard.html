<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Blue Chip Signals</title>
    <link rel="icon" type="image/png" href="assets/images/logo.png">
    <link rel="stylesheet" href="assets/css/global.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { overflow-x: hidden; }

        .main-content {
            margin-top: 110px;
            padding: 0 2rem 2rem;
            max-width: 1100px;
            margin-left: auto;
            margin-right: auto;
        }

        /* ---- Welcome bar ---- */
        .dash-welcome {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 0 1.25rem;
            margin-bottom: 1.25rem;
            border-bottom: 1px solid rgba(201, 176, 55, 0.12);
        }

        .dash-welcome h1 {
            font-size: 1.4rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary-gold), var(--secondary-gold));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .dash-welcome .sub-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.45rem;
            background: rgba(42, 87, 31, 0.15);
            border: 1px solid var(--success-green);
            color: var(--success-green);
            padding: 0.35rem 0.9rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            white-space: nowrap;
        }

        .dash-welcome .sub-badge i { font-size: 0.7rem; }

        /* ---- Bento grid ---- */
        .bento-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            grid-template-rows: auto auto;
            gap: 1.25rem;
        }

        .bento-card {
            background: rgba(10, 14, 22, 0.7);
            border: 1px solid rgba(201, 176, 55, 0.18);
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: 0 6px 24px rgba(0, 0, 0, 0.3);
        }

        .bento-card-title {
            font-size: 1.05rem;
            font-weight: 700;
            color: var(--primary-gold);
            margin-bottom: 1.1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .bento-card-title i { font-size: 0.95rem; }

        /* ---- Stock table ---- */
        .card-stocks { grid-column: 1; grid-row: 1; overflow: hidden; }

        .stock-row {
            display: flex;
            align-items: center;
            padding: 0.7rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.04);
            gap: 0.75rem;
        }

        .stock-row:last-child { border-bottom: none; }

        .stock-ticker-icon {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.65rem;
            font-weight: 800;
            letter-spacing: 0.02em;
            flex-shrink: 0;
            border: 1px solid rgba(255, 255, 255, 0.08);
        }

        .stock-info {
            flex: 1;
            min-width: 0;
        }

        .stock-info .ticker {
            font-weight: 700;
            font-size: 0.92rem;
            color: var(--light-text);
        }

        .stock-info .name {
            font-size: 0.78rem;
            color: var(--gray-text);
        }

        .stock-actions {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            flex-shrink: 0;
        }

        .stock-actions .tg-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.35rem;
            padding: 0.3rem 0.7rem;
            border: 1px solid rgba(201, 176, 55, 0.3);
            border-radius: 8px;
            color: var(--primary-gold);
            font-size: 0.75rem;
            font-weight: 600;
            text-decoration: none;
            background: transparent;
            transition: background 0.2s, border-color 0.2s;
            white-space: nowrap;
        }

        .stock-actions .tg-btn:hover {
            background: rgba(201, 176, 55, 0.1);
            border-color: var(--primary-gold);
        }

        .stock-actions .tg-btn i { font-size: 0.8rem; }

        .stock-actions .signals-link {
            color: var(--primary-gold);
            font-size: 0.78rem;
            font-weight: 600;
            text-decoration: none;
            white-space: nowrap;
            transition: color 0.2s;
        }

        .stock-actions .signals-link:hover {
            color: var(--secondary-gold);
        }

        /* ---- Journal card ---- */
        .card-journal {
            grid-column: 2;
            grid-row: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            justify-content: center;
            gap: 0.85rem;
        }

        .journal-icon {
            width: 56px;
            height: 56px;
            border-radius: 14px;
            background: linear-gradient(135deg, #D4AF37, #f4d03f);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.4rem;
            color: #0a0a0a;
        }

        .journal-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.3rem;
            background: linear-gradient(135deg, #D4AF37, #f4d03f);
            color: #0a0a0a;
            padding: 0.25rem 0.65rem;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 700;
        }

        .card-journal h3 {
            font-size: 1.15rem;
            font-weight: 700;
            color: var(--light-text);
            margin: 0;
        }

        .card-journal .journal-desc {
            font-size: 0.85rem;
            color: var(--gray-text);
            line-height: 1.5;
        }

        .journal-open-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.4rem;
            padding: 0.6rem 1.6rem;
            border-radius: 50px;
            background: linear-gradient(135deg, var(--primary-gold), var(--secondary-gold));
            color: var(--darker-bg);
            font-weight: 700;
            font-size: 0.88rem;
            text-decoration: none;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 4px 14px rgba(201, 176, 55, 0.25);
        }

        .journal-open-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(201, 176, 55, 0.4);
        }

        /* ---- Planner card ---- */
        .card-planner {
            grid-column: 2;
            grid-row: 2;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            justify-content: center;
            gap: 0.85rem;
        }

        .planner-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            background: linear-gradient(135deg, #D4AF37, #f4d03f);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            color: #0a0a0a;
        }

        .planner-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.3rem;
            background: linear-gradient(135deg, #D4AF37, #f4d03f);
            color: #0a0a0a;
            padding: 0.25rem 0.65rem;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 700;
        }

        .card-planner h3 {
            font-size: 1.05rem;
            font-weight: 700;
            color: var(--light-text);
            margin: 0;
        }

        .card-planner .planner-desc {
            font-size: 0.82rem;
            color: var(--gray-text);
            line-height: 1.5;
        }

        .planner-open-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.4rem;
            padding: 0.55rem 1.4rem;
            border-radius: 50px;
            background: linear-gradient(135deg, var(--primary-gold), var(--secondary-gold));
            color: var(--darker-bg);
            font-weight: 700;
            font-size: 0.85rem;
            text-decoration: none;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 4px 14px rgba(201, 176, 55, 0.25);
        }

        .planner-open-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(201, 176, 55, 0.4);
        }

        /* ---- Live ticker strip ---- */
        .ticker-strip {
            overflow: hidden;
            margin-bottom: 1rem;
            -webkit-mask-image: linear-gradient(to right, transparent 0%, black 6%, black 94%, transparent 100%);
            mask-image: linear-gradient(to right, transparent 0%, black 6%, black 94%, transparent 100%);
            border-top: 1px solid rgba(201, 176, 55, 0.1);
            border-bottom: 1px solid rgba(201, 176, 55, 0.1);
            padding: 0.4rem 0;
        }

        .ticker-track {
            display: flex;
            gap: 0;
            width: max-content;
            animation: ticker-scroll 48s linear infinite;
        }

        .ticker-track:hover { animation-play-state: paused; }

        @keyframes ticker-scroll {
            from { transform: translateX(0); }
            to   { transform: translateX(-50%); }
        }

        .ticker-item {
            display: inline-flex;
            align-items: center;
            gap: 0.45rem;
            padding: 0 1.5rem;
            font-size: 0.78rem;
            font-weight: 600;
            white-space: nowrap;
            border-right: 1px solid rgba(255, 255, 255, 0.06);
        }

        .ticker-dot { width: 5px; height: 5px; border-radius: 50%; flex-shrink: 0; }
        .ticker-sym { color: var(--light-text); letter-spacing: 0.04em; }
        .ticker-price { color: var(--gray-text); }
        .ticker-change.up   { color: #4ade80; }
        .ticker-change.down { color: #ef4444; }
        .ticker-dot.up   { background: #4ade80; }
        .ticker-dot.down { background: #ef4444; }
        a.ticker-item { text-decoration: none; }
        a.ticker-item:hover { background: rgba(201,176,55,0.06); border-radius: 6px; }

        /* ---- Quick links (slim strip) ---- */
        .card-links {
            grid-column: 1;
            grid-row: 2;
            align-self: start;
            padding: 0.9rem 1.2rem;
            background: rgba(10, 14, 22, 0.5);
            border-color: rgba(201, 176, 55, 0.1);
        }

        .card-links .bento-card-title {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--gray-text);
            margin-bottom: 0.5rem;
        }

        .quick-link-row {
            display: flex;
            align-items: center;
            gap: 0.6rem;
            padding: 0.45rem 0.3rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.03);
            text-decoration: none;
            border-radius: 4px;
            transition: background 0.15s;
        }

        .quick-link-row:last-child { border-bottom: none; }

        .quick-link-row:hover { background: rgba(201, 176, 55, 0.04); }

        .quick-link-row .ql-icon {
            width: 22px;
            height: 22px;
            border-radius: 5px;
            background: rgba(179, 161, 125, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary-gold);
            font-size: 0.72rem;
            flex-shrink: 0;
        }

        .quick-link-row .ql-label {
            flex: 1;
            font-size: 0.8rem;
            font-weight: 500;
            color: rgba(255, 255, 255, 0.7);
        }

        .quick-link-row .ql-arrow {
            color: rgba(255, 255, 255, 0.2);
            font-size: 0.65rem;
            transition: color 0.15s, transform 0.15s;
        }

        .quick-link-row:hover .ql-label { color: var(--light-text); }

        .quick-link-row:hover .ql-arrow {
            color: var(--primary-gold);
            transform: translateX(2px);
        }

        /* ---- Responsive ---- */
        @media (max-width: 768px) {
            .main-content {
                padding: 0 1rem 1.5rem;
                margin-top: 90px;
            }

            .dash-welcome h1 { font-size: 1.15rem; }

            .bento-grid {
                grid-template-columns: 1fr;
                grid-template-rows: auto;
            }

            .card-stocks  { grid-column: 1; grid-row: auto; }
            .card-journal { grid-column: 1; grid-row: auto; padding: 2rem 1.5rem; }
            .card-planner { grid-column: 1; grid-row: auto; padding: 2rem 1.5rem; }
            .card-links   { grid-column: 1; grid-row: auto; }

            .stock-row { flex-wrap: wrap; }

            .stock-actions {
                width: 100%;
                padding-left: 2.6rem;
                margin-top: 0.25rem;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <div id="nav-placeholder" data-nav-type="loggedin"></div>
    <script src="assets/js/nav-component.js"></script>

    <!-- Main Content -->
    <div class="main-content">

        <!-- Welcome Bar -->
        <div class="dash-welcome">
            <h1 id="welcomeMessage">Welcome back!</h1>
            <span class="sub-badge"><i class="fas fa-crown"></i> <span id="subscriptionStatus">Premium Active</span></span>
        </div>

        <!-- Bento Grid -->
        <div class="bento-grid">

            <!-- Stock Channels Table -->
            <div class="bento-card card-stocks">
                <div class="bento-card-title"><i class="fas fa-chart-line"></i> Your Signal Channels</div>

                <!-- Live Ticker Strip -->
                <div class="ticker-strip">
                    <div class="ticker-track" id="tickerTrack">
                        <div class="ticker-item">
                            <span class="ticker-dot"></span>
                            <span class="ticker-sym">Loading...</span>
                        </div>
                    </div>
                </div>

                <div class="stock-row">
                    <div class="stock-ticker-icon" style="background:rgba(179,161,125,0.15);color:var(--primary-gold);">SPY</div>
                    <div class="stock-info"><span class="ticker">SPY</span> <span class="name">S&P 500 ETF Trust</span></div>
                    <div class="stock-actions">
                        <a href="https://t.me/+vaznP276aM1jMGVh" target="_blank" class="tg-btn"><i class="fab fa-telegram"></i> Telegram</a>
                        <a href="pages/bots/spy-bot.html" class="signals-link">View Guide &rarr;</a>
                    </div>
                </div>

                <div class="stock-row">
                    <div class="stock-ticker-icon" style="background:rgba(255,102,102,0.12);color:#ff6666;">TSLA</div>
                    <div class="stock-info"><span class="ticker">TSLA</span> <span class="name">Tesla, Inc.</span></div>
                    <div class="stock-actions">
                        <a href="https://t.me/+EUxramV9fkI4MDVh" target="_blank" class="tg-btn"><i class="fab fa-telegram"></i> Telegram</a>
                        <a href="pages/bots/tsla-bot.html" class="signals-link">View Guide &rarr;</a>
                    </div>
                </div>

                <div class="stock-row">
                    <div class="stock-ticker-icon" style="background:rgba(91,158,255,0.12);color:#5b9eff;">META</div>
                    <div class="stock-info"><span class="ticker">META</span> <span class="name">Meta Platforms</span></div>
                    <div class="stock-actions">
                        <a href="https://t.me/+95vOUdI99VM0ZDNh" target="_blank" class="tg-btn"><i class="fab fa-telegram"></i> Telegram</a>
                        <a href="pages/bots/meta-bot.html" class="signals-link">View Guide &rarr;</a>
                    </div>
                </div>

                <div class="stock-row">
                    <div class="stock-ticker-icon" style="background:rgba(179,179,179,0.12);color:#b3b3b3;">AAPL</div>
                    <div class="stock-info"><span class="ticker">AAPL</span> <span class="name">Apple Inc.</span></div>
                    <div class="stock-actions">
                        <a href="https://t.me/+ItfI3WYEZ1g1NzQx" target="_blank" class="tg-btn"><i class="fab fa-telegram"></i> Telegram</a>
                        <a href="pages/bots/aapl-bot.html" class="signals-link">View Guide &rarr;</a>
                    </div>
                </div>

                <div class="stock-row">
                    <div class="stock-ticker-icon" style="background:rgba(143,219,47,0.12);color:#8fdb2f;">NVDA</div>
                    <div class="stock-info"><span class="ticker">NVDA</span> <span class="name">NVIDIA Corporation</span></div>
                    <div class="stock-actions">
                        <a href="https://t.me/+_de2o3DNnu44ODg5" target="_blank" class="tg-btn"><i class="fab fa-telegram"></i> Telegram</a>
                        <a href="pages/bots/nvda-bot.html" class="signals-link">View Guide &rarr;</a>
                    </div>
                </div>

                <div class="stock-row">
                    <div class="stock-ticker-icon" style="background:rgba(255,170,51,0.12);color:#ffaa33;">AMZN</div>
                    <div class="stock-info"><span class="ticker">AMZN</span> <span class="name">Amazon.com, Inc.</span></div>
                    <div class="stock-actions">
                        <a href="https://t.me/+XEuyiOt5-Vc1OTJh" target="_blank" class="tg-btn"><i class="fab fa-telegram"></i> Telegram</a>
                        <a href="pages/bots/amzn-bot.html" class="signals-link">View Guide &rarr;</a>
                    </div>
                </div>
            </div>

            <!-- Trading Journal -->
            <div class="bento-card card-journal">
                <div class="journal-icon"><i class="fas fa-book"></i></div>
                <div>
                    <h3>Trading Journal</h3>
                    <span class="journal-badge"><i class="fas fa-star"></i> New Feature</span>
                </div>
                <p class="journal-desc">Track your trades, analyze performance, and visualize your P&L with interactive charts.</p>
                <a href="trading-journal.html" class="journal-open-btn">Open Journal <i class="fas fa-arrow-right"></i></a>
            </div>

            <!-- Trade Planner -->
            <div class="bento-card card-planner">
                <div class="planner-icon"><i class="fas fa-crosshairs"></i></div>
                <div>
                    <h3>Trade Planner</h3>
                    <span class="planner-badge"><i class="fas fa-star"></i> New Feature</span>
                </div>
                <p class="planner-desc">Plan before you trade. Calculate R:R, position size &amp; max risk.</p>
                <a href="trade-planner.html" class="planner-open-btn">Open Planner <i class="fas fa-arrow-right"></i></a>
            </div>

            <!-- Quick Links -->
            <div class="bento-card card-links">
                <div class="bento-card-title"><i class="fas fa-link"></i> Quick Links</div>
                <a href="contact.html" class="quick-link-row">
                    <span class="ql-icon"><i class="fas fa-headset"></i></span>
                    <span class="ql-label">Contact Support</span>
                    <span class="ql-arrow"><i class="fas fa-chevron-right"></i></span>
                </a>
                <a href="faq.html" class="quick-link-row">
                    <span class="ql-icon"><i class="fas fa-question-circle"></i></span>
                    <span class="ql-label">FAQ</span>
                    <span class="ql-arrow"><i class="fas fa-chevron-right"></i></span>
                </a>
                <a href="about.html" class="quick-link-row">
                    <span class="ql-icon"><i class="fas fa-rocket"></i></span>
                    <span class="ql-label">Getting Started</span>
                    <span class="ql-arrow"><i class="fas fa-chevron-right"></i></span>
                </a>
                <a href="terms.html" class="quick-link-row">
                    <span class="ql-icon"><i class="fas fa-file-alt"></i></span>
                    <span class="ql-label">Legal Info</span>
                    <span class="ql-arrow"><i class="fas fa-chevron-right"></i></span>
                </a>
            </div>

        </div>
    </div>

    <!-- Footer -->
    <div id="footer-placeholder" data-footer-type="standard-social" data-base=""></div>
    <script src="assets/js/footer-component.js"></script>

    <!-- Live Ticker Bar -->
    <script>
    (function () {
        const FINNHUB_KEY = 'd0lumg9r01qpni31glsgd0lumg9r01qpni31glt0';
        const TICKERS     = ['SPY', 'TSLA', 'META', 'AAPL', 'NVDA', 'AMZN', 'GOOGL', 'MSFT', 'AVGO', 'BRK.B'];
        const GUIDE_PATHS = {
            SPY:   'pages/bots/spy-bot.html',
            TSLA:  'pages/bots/tsla-bot.html',
            META:  'pages/bots/meta-bot.html',
            AAPL:  'pages/bots/aapl-bot.html',
            NVDA:  'pages/bots/nvda-bot.html',
            AMZN:  'pages/bots/amzn-bot.html',
            GOOGL: '#',
            MSFT:  '#',
            AVGO:  '#',
            'BRK.B': '#'
        };

        async function fetchQuotes() {
            const results = await Promise.all(
                TICKERS.map(sym =>
                    fetch('https://finnhub.io/api/v1/quote?symbol=' + sym + '&token=' + FINNHUB_KEY)
                        .then(function (r) { return r.json(); })
                        .then(function (d) { return { sym: sym, price: d.c, change: d.dp }; })
                        .catch(function ()  { return { sym: sym, price: null, change: null }; })
                )
            );
            return results;
        }

        function buildHTML(quotes) {
            var items = quotes.map(function (q) {
                var dir   = (q.change == null || q.change >= 0) ? 'up' : 'down';
                var sign  = (q.change != null && q.change >= 0) ? '+' : '';
                var price = q.price  != null ? '$' + q.price.toFixed(2)         : '—';
                var chg   = q.change != null ? sign + q.change.toFixed(2) + '%' : '—';
                var href  = GUIDE_PATHS[q.sym] || '#';
                return '<a class="ticker-item" href="' + href + '">' +
                    '<span class="ticker-dot ' + dir + '"></span>' +
                    '<span class="ticker-sym">'                     + q.sym  + '</span>' +
                    '<span class="ticker-price">'                   + price  + '</span>' +
                    '<span class="ticker-change ' + dir + '">'      + chg    + '</span>' +
                '</a>';
            }).join('');
            return items + items; /* duplicate for seamless loop */
        }

        async function refresh() {
            var quotes = await fetchQuotes();
            var track  = document.getElementById('tickerTrack');
            if (track) track.innerHTML = buildHTML(quotes);
        }

        document.addEventListener('DOMContentLoaded', function () {
            refresh();
            setInterval(refresh, 60000);
        });
    })();
    </script>

    <!-- Firebase Authentication -->
    <script type="module">
        import { auth, db, onAuthStateChanged, signOut, doc, getDoc, setDoc } from './assets/js/firebase-config.js';

        // Get or create user profile
        async function getUserProfile(userId, userEmail) {
            try {
                const userDocRef = doc(db, 'users', userId);
                const userDoc = await getDoc(userDocRef);
                
                if (userDoc.exists()) {
                    const userData = userDoc.data();
                    
                    // Check if user has completed setup
                    if (!userData.setupCompleted) {
                        // Redirect to welcome setup page
                        window.location.href = 'welcome-setup.html';
                        return null;
                    }
                    
                    // User profile exists and setup is complete
                    return userData;
                } else {
                    // New user - redirect to welcome setup
                    window.location.href = 'welcome-setup.html';
                    return null;
                }
            } catch (error) {
                console.error('Error loading user profile:', error);
                return null;
            }
        }

        function updateDashboard(userData) {
            const welcomeMessage = document.getElementById('welcomeMessage');
            const subscriptionStatus = document.getElementById('subscriptionStatus');
            
            if (userData) {
                const firstName = userData.firstName || userData.displayName || 'there';
                welcomeMessage.textContent = `Welcome back, ${firstName}!`;
                subscriptionStatus.textContent = userData.subscriptionStatus || 'Premium Active';
            }
        }

        // Check if user is authenticated
        onAuthStateChanged(auth, async (user) => {
            if (!user) {
                // User is not logged in, redirect to login page
                window.location.href = 'login.html';
            } else {
                // User is logged in, load their profile
                const userData = await getUserProfile(user.uid, user.email);
                updateDashboard(userData);
            }
        });

        // Logout function
        window.logout = async function() {
            try {
                await signOut(auth);
                // Clear local storage
                localStorage.removeItem('bluechip_logged_in');
                localStorage.removeItem('bluechip_user_email');
                sessionStorage.removeItem('bluechip_logged_in');
                sessionStorage.removeItem('bluechip_user_email');
                // Redirect to login
                window.location.href = 'login.html';
            } catch (error) {
                console.error('Logout error:', error);
                alert('Error logging out. Please try again.');
            }
        };
    </script>
</body>
</html>
